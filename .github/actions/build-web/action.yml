name: 'Build Web composite action'
description: 'An example composite action that builds an Web image'
inputs:
  image:
    description: 'Web Image Name'
    required: true
  push:
    description: 'Push the image to the registry'
    required: false
    default: 'true'
runs:
  using: "composite"
  steps:
    - name: Echo all environment variable to apps/web
      shell: bash
      run: |
        printenv | grep -E '^(FE_ENV|FE_PORT)' >> apps/web/.env
        cat apps/web/.env

    - name: Build Web
      id: build-web
      shell: bash
      env:
        IMAGE_TAG: ${{ github.sha }}
      run: |
        docker build -f Dockerfile.Web \
        --build-arg FE_ENV=$FE_ENV \
        --build-arg FE_PORT=${{ secrets.FE_PORT }} \
        -t ${{ inputs.image }} .

    - name: Push Web
      if: ${{ inputs.push == 'true' }}
      shell: bash
      run: docker push ${{ inputs.image }}
